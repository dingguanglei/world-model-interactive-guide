<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>04. æ·±åº¦æ•°æ®å·¥ç¨‹ - World Model Guide</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({ startOnLoad: true, theme: 'default' });</script>
</head>

<body>
    <nav class="sidebar">
        <div class="brand">ğŸš€ World Model Guide</div>
        <ul class="nav-links">
            <li class="nav-item"><a href="index.html" class="nav-link">00. æ¦‚è§ˆ (Overview)</a></li>
            <li class="nav-item"><a href="01_industry.html" class="nav-link">01. è¡Œä¸šå…¨æ™¯ (Landscape)</a></li>
            <li class="nav-item"><a href="02_product.html" class="nav-link">02. äº§å“æ·±åº¦ (Deep Dive)</a></li>
            <li class="nav-item"><a href="03_architecture.html" class="nav-link">03. æŠ€æœ¯æ¶æ„ (Architecture)</a></li>
            <li class="nav-item"><a href="04_data.html" class="nav-link active">04. æ•°æ®å·¥ç¨‹ (Data Bible)</a></li>
            <li class="nav-item"><a href="05_roadmap.html" class="nav-link">05. è½åœ°è·¯çº¿ (Roadmap)</a></li>
            <li class="nav-item"><a href="06_companies.html" class="nav-link">06. å…¬å¸è°ƒç ” (Companies)</a></li>
            <li class="nav-item"><a href="07_paper_tracker.html" class="nav-link">07. è®ºæ–‡è¿½è¸ª (Papers)</a></li>
            <li class="nav-item"><a href="08_community.html" class="nav-link">08. ç¤¾åŒºåŠ¨æ€ (Community)</a></li>
            <li class="nav-item"><a href="references.html" class="nav-link">é™„å½•ï¼šå‚è€ƒæ–‡çŒ® (Refs)</a></li>
        </ul>
    </nav>

    <main class="main-content">
        <h1>04. æ·±åº¦æ•°æ®å·¥ç¨‹ï¼šåˆæˆæ•°æ®ä¸è‡ªåŠ¨æ ‡æ³¨ (The Data Bible)</h1>
        <blockquote>
            <strong>"Data is the new Code."</strong> æœ¬ç« å°†æ•°æ®å·¥ç¨‹æå‡åˆ°æˆ˜ç•¥é«˜åº¦ï¼Œè¯¦ç»†æ‹†è§£å¦‚ä½•æ„å»ºä¸€ä¸ª"è‡ªç”Ÿé•¿"çš„æ•°æ®é—­ç¯ã€‚
        </blockquote>

        <section>
            <h2>4.1 æ•°æ®ç®¡çº¿å…¨æ™¯å›¾ (Data Pipeline Overview)</h2>
            <p>ä» UE å¼•æ“åˆ° WebDataset åˆ†ç‰‡ï¼Œæˆ‘ä»¬éœ€è¦ç»è¿‡ä¸‰ä¸ªæ ¸å¿ƒé˜¶æ®µï¼š<strong>é‡‡é›† (Recording)</strong> -> <strong>æ ‡æ³¨
                    (Re-captioning)</strong> -> <strong>æ‰“åŒ… (Sharding)</strong>ã€‚</p>

            <pre class="mermaid">
flowchart TD
    subgraph UE5 [Phase 1: è™šæ‹Ÿä»¿çœŸ]
        Engine[Unreal Engine 5]
        Agent[RL Agent / Script]
        Engine -->|Raw Video + Action| RawData[Raw MP4 + JSON]
    end
    
    subgraph VLM [Phase 2: è¯­ä¹‰å¢å¼º Crucial]
        RawData -->|Sample Frames| Frames[Key Frames]
        Frames -->|Prompt: Describe this scene| GPT4V[VLM - GPT4o / Gemini]
        GPT4V -->|Dense Caption| Caption[Detailed Text Description]
    end
    
    subgraph ETL [Phase 3: æ¸…æ´—ä¸åˆ†ç‰‡]
        RawData -->|Merge| Caption
        Caption -->|Filter| CleanData
        CleanData -->|WebDataset| Shards[Tar Shards 000.tar]
    end
            </pre>
        </section>

        <section>
            <h2>4.2 æ ¸å¿ƒç­–ç•¥ 1ï¼šVLM è‡ªåŠ¨æ ‡æ³¨ (Re-captioning)</h2>
            <p><a href="https://openai.com/sora" target="_blank">OpenAI Sora</a> çš„æ ¸å¿ƒç§˜å¯†åœ¨äºè®­ç»ƒæ•°æ®ä½¿ç”¨äº†æé«˜è´¨é‡çš„
                <strong>Machine-Generated Captions</strong>ã€‚æˆ‘ä»¬å¿…é¡»å¤åˆ»è¿™ä¸€è¿‡ç¨‹ã€‚</p>

            <h3>ä¸ºä»€ä¹ˆéœ€è¦?</h3>
            <p>UE å¯¼å‡ºçš„ JSON åªæœ‰ <code>Jump</code>, <code>Run</code> ç­‰ç¦»æ•£åŠ¨ä½œï¼Œç¼ºä¹è¯­ä¹‰ï¼ˆå¦‚ "A cyberpunk city in
                rain"ï¼‰ã€‚æ²¡æœ‰æ–‡æœ¬è¯­ä¹‰ï¼Œæ¨¡å‹å°±æ— æ³•å“åº” Text Promptã€‚</p>

            <h3>è‡ªåŠ¨æ ‡æ³¨è„šæœ¬ (Auto-Labeling Pipeline)</h3>
            <pre><code class="language-python"># auto_caption.py
def generate_dense_caption(video_path):
    """
    ä½¿ç”¨ VLM ç”Ÿæˆ Sora çº§åˆ«çš„è¯¦ç»†æè¿°ã€‚
    """
    frames = sample_frames(video_path, num=5) # æŠ½5å¸§
    
    prompt = """
    Describe this video clip in extreme detail. Focus on:
    1. The environment (lighting, textures, weather).
    2. The main character (apparel, movement).
    3. The camera movement (pan, tilt, zoom).
    4. The physics interactions (fluids, particles).
    
    Output format: A single dense paragraph.
    """
    
    # æ¨¡æ‹Ÿè°ƒç”¨ Gemini Vision / GPT-4V
    caption = call_vlm_api(frames, prompt)
    return caption

# ç¤ºä¾‹è¾“å‡ºï¼š
# "A first-person view navigating a dimly lit cavern. The walls are covered in 
# bio-luminescent moss emitting a faint blue glow. The camera shakes violently 
# as the character sprints forward, jumping over a chasm..."
</code></pre>
        </section>

        <section>
            <h2>4.3 æ ¸å¿ƒç­–ç•¥ 2ï¼šWebDataset é«˜æ€§èƒ½åˆ†ç‰‡</h2>
            <p><strong>ç—›ç‚¹</strong>: 100 ä¸‡ä¸ª MP4 æ–‡ä»¶ä¼šå¯¼è‡´æ–‡ä»¶ç³»ç»Ÿç´¢å¼•å´©æºƒï¼ˆInode Exhaustionï¼‰ã€‚<br>
                <strong>è§£æ³•</strong>: ä½¿ç”¨
                <code><a href="https://github.com/webdataset/webdataset" target="_blank">WebDataset</a></code> å°†æ•°æ®æ‰“åŒ…æˆ
                1GB å·¦å³çš„ <code>.tar</code> åŒ…ã€‚
            </p>

            <h3>ç›®å½•ç»“æ„è§„èŒƒ</h3>
            <pre><code>dataset_optimized/
â”œâ”€â”€ shard_00000.tar   # åŒ…å« 1000 ä¸ªè§†é¢‘ (video_0.mp4, video_0.json, video_0.txt)
â”œâ”€â”€ shard_00001.tar
â””â”€â”€ ...
</code></pre>

            <h3>JSON Schema (Metadata)</h3>
            <p>æ¯ä¸ªè§†é¢‘ä¼´éšçš„ <code>.json</code> æ–‡ä»¶å¿…é¡»ä¸¥æ ¼å®šä¹‰ï¼š</p>
            <pre><code class="language-json">{
  "clip_id": "ue_level3_run05_001",
  "duration": 5.0,
  "fps": 24,
  "resolution": [1280, 720],
  "camera": {
    "fov": 90,
    "intrinsics": [ [500, 0, 640], [0, 500, 360], [0, 0, 1] ]
  },
  "controls": {
    "input_type": "keyboard_mouse",
    "action_sequence": [
      {"frame": 0, "keys": ["W"], "mouse_delta": [0, 0]},
      {"frame": 1, "keys": ["W", "Space"], "mouse_delta": [10, -5]}
    ]
  },
  "caption": "A detailed description generated by VLM...",
  "quality_score": 0.95
}</code></pre>
        </section>

        <section>
            <h2>4.4 æ ¸å¿ƒç­–ç•¥ 3ï¼šåŸºäºçŠ¶æ€æœºçš„æ ·æœ¬å¹³è¡¡ (Balancing)</h2>
            <p>åœ¨ UE é‡‡é›†ç«¯ï¼Œä¸è¦éšæœºä¹±è·‘ã€‚ç¼–å†™ä¸€ä¸ª <strong>State Machine Bot</strong> æ¥ä¿è¯æ ·æœ¬å¤šæ ·æ€§ã€‚</p>
            <p><strong>å»ºè®®åˆ†å¸ƒ</strong>:</p>
            <ul>
                <li><strong>Exploration (50%)</strong>: èµ°è·¯ã€è·‘æ­¥ã€çœ‹é£æ™¯ã€‚è¿™æ˜¯æ„å»ºä¸–ç•Œè§‚çš„åŸºç¡€ã€‚</li>
                <li><strong>Interaction (30%)</strong>: å¼€é—¨ã€æ¡ä¸œè¥¿ã€ç ´åç‰©ä½“ã€‚å­¦ä¹ ç‰©ç†è§„å¾‹ã€‚</li>
                <li><strong>Idle (10%)</strong>: ç«™ç«‹ä¸åŠ¨ï¼Œè§‚å¯Ÿç¯å¢ƒåŠ¨æ€ï¼ˆäº‘çš„é£˜åŠ¨ã€æ°´çš„æµåŠ¨ï¼‰ã€‚</li>
                <li><strong>Combat/Extreme (10%)</strong>: å‰§çƒˆè¿åŠ¨ã€ç‰¹æ•ˆçˆ†ç‚¸ã€‚é˜²æ­¢æ¨¡å‹åœ¨åŠ¨æ€åœºæ™¯å´©åã€‚</li>
            </ul>
        </section>

        <section>
            <h2>4.5 æ ¸å¿ƒä»£ç é€»è¾‘ï¼šC++ Recorder æ’ä»¶æ›´æ–°</h2>
            <pre><code class="language-cpp">// URecorderComponent.cpp (Enhanced)

void URecorderComponent::TickComponent(...) {
    // ... [RGB & Depth Capture ä»£ç åŒä¸Š] ...
    
    // è·å–å½“å‰ Bot çŠ¶æ€ (ç”¨äºæ•°æ®é›†å¹³è¡¡åˆ†æ)
    FString CurrentState = BotAIController->GetStateName(); // e.g., "Combat"
    
    // åºåˆ—åŒ–ï¼Œå¢åŠ è¯­ä¹‰æ ‡ç­¾
    FString MetaJson = FString::Printf(TEXT(
        "{\"t\": %.3f, \"state\": \"%s\", \"action\": ...}"
    ), Timestamp, *CurrentState);
    
    // åªæœ‰å½“ç”»é¢å˜åŒ–å¹…åº¦ > é˜ˆå€¼ OR å¤„äºå…³é”®äº¤äº’æ—¶æ‰ä¿å­˜
    // é¿å…å­˜å‚¨å¤§é‡æ— æ„ä¹‰çš„é™æ­¢ç”»é¢ (Dedup)
    if (IsSignificantFrame(RGB_Data)) {
        DiskWriter->Write(RGB_Data, MetaJson);
    }
}</code></pre>
        </section>

        <section>
            <h2>4.6 é¿å‘æŒ‡å— (Best Practices)</h2>
            <ol>
                <li><strong>VLM æˆæœ¬æ§åˆ¶</strong>: è·‘ä¸€é 1200 å°æ—¶è§†é¢‘çš„ VLM æ ‡æ³¨éå¸¸è´µã€‚å»ºè®®ï¼š<strong>å…³é”®å¸§æ ‡æ³¨</strong> (æ¯ 2 ç§’æŠ½ 1 å¸§åš
                    VLM)ï¼Œä¸­é—´å¸§æ²¿ç”¨ä¸Šä¸€å…³é”®å¸§çš„ Caption (<strong>æ’å€¼</strong>)ã€‚</li>
                <li><strong>Gamma æ ¡æ­£é™·é˜±</strong>: UE RenderTarget é»˜è®¤æ˜¯ Linear Spaceã€‚å¯¼å‡º JPG/PNG æ—¶åŠ¡å¿…æ‰‹åŠ¨åš Gamma 2.2
                    Correctionï¼Œå¦åˆ™è§†é¢‘ä¼š<strong>æƒ¨ç™½</strong>ã€‚</li>
                <li><strong>FOV é”å®š</strong>: è®­ç»ƒæ—¶å°½é‡å›ºå®š FOV (e.g., 90åº¦)ã€‚å¦‚æœ FOV ä¹±å˜ï¼Œæ¨¡å‹å¾ˆéš¾å­¦å¾—ä¼šç©ºé—´é€è§†ã€‚</li>
            </ol>

            <div class="commentary">
                <div class="commentary-title">ğŸ§  AntiGravity's Commentary</div>
                <p><strong>ä¸¥æ­£è­¦å‘Šï¼š</strong> ä¸è¦ç”¨ Screen Captureï¼å› ä¸ºå½•å±ä¼šå½•åˆ° Windows å¼¹çª—ã€é¼ æ ‡å…‰æ ‡ã€Steam å¸§æ•°æ˜¾ç¤ºï¼Œè¿™äº›éƒ½æ˜¯"æ±¡æŸ“"ã€‚ä¸€å®šè¦ç”¨ Unreal
                    Engine çš„ <code>USceneCaptureComponent2D</code> è¿›è¡Œçº¯å‡€çš„ Off-screen Renderingã€‚</p>
            </div>
        </section>

    </main>
</body>

</html>